<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mo6O19 Cluster</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f5f5;
            overflow: hidden;
        }
        
        #canvas-container {
            width: 100%;
            height: 600px;
            background: #ffffff;
            border: 2px solid #000;
            cursor: grab;
        }
        
        #canvas-container:active {
            cursor: grabbing;
        }
        
        .controls {
            padding: 15px;
            background: #1a1a1a;
            color: white;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        button {
            padding: 8px 16px;
            border: 2px solid white;
            background: transparent;
            color: white;
            font-size: 14px;
            cursor: pointer;
            border-radius: 4px;
            font-weight: 600;
        }
        
        button:hover {
            background: white;
            color: #1a1a1a;
        }
        
        button.active {
            background: white;
            color: #1a1a1a;
        }
        
        .info {
            padding: 12px 15px;
            background: #2a2a2a;
            color: #ccc;
            font-size: 13px;
            border-top: 1px solid #444;
        }
    </style>
</head>
<body>
    <div class="controls">
        <span style="font-weight: bold; margin-right: 10px;">Mo₆O₁₉ Cluster:</span>
        <button class="active" onclick="setViewMode('ball-stick')">Ball & Stick</button>
        <button onclick="setViewMode('space-fill')">Space-Filling</button>
        <button onclick="toggleLabels()">Toggle Labels</button>
    </div>
    
    <div id="canvas-container"></div>
    
    <div class="info">
        <strong>Drag to rotate</strong> • Cyan = Molybdenum • Red = Oxygen
    </div>

    <script>
        let scene, camera, renderer, moleculeGroup;
        let viewMode = 'ball-stick';
        let showLabels = false;
        let isDragging = false;
        let previousMouse = { x: 0, y: 0 };

        function init() {
            const container = document.getElementById('canvas-container');
            
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0xffffff);

            camera = new THREE.PerspectiveCamera(
                50,
                container.clientWidth / container.clientHeight,
                0.1,
                1000
            );
            camera.position.set(8, 8, 8);
            camera.lookAt(0, 0, 0);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(container.clientWidth, container.clientHeight);
            container.appendChild(renderer.domElement);

            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);

            const directionalLight1 = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight1.position.set(10, 10, 10);
            scene.add(directionalLight1);

            const directionalLight2 = new THREE.DirectionalLight(0xffffff, 0.4);
            directionalLight2.position.set(-10, -10, -10);
            scene.add(directionalLight2);

            moleculeGroup = new THREE.Group();
            scene.add(moleculeGroup);

            buildMolecule();

            // Mouse controls
            renderer.domElement.addEventListener('mousedown', onMouseDown);
            renderer.domElement.addEventListener('mousemove', onMouseMove);
            renderer.domElement.addEventListener('mouseup', onMouseUp);

            window.addEventListener('resize', onWindowResize);

            animate();
        }

        function buildMolecule() {
            while (moleculeGroup.children.length > 0) {
                moleculeGroup.remove(moleculeGroup.children[0]);
            }

            const atoms = [
                { id: 1, element: 'Mo', pos: [-2.0808, -0.0000, -0.0000], label: 'Mo1' },
                { id: 2, element: 'Mo', pos: [-0.0000, -0.0000, -2.0808], label: 'Mo2' },
                { id: 3, element: 'Mo', pos: [0.0000, -0.0000, 2.0808], label: 'Mo3' },
                { id: 4, element: 'Mo', pos: [2.0808, 0.0000, -0.0000], label: 'Mo4' },
                { id: 5, element: 'Mo', pos: [0.0000, -2.0808, -0.0000], label: 'Mo5' },
                { id: 6, element: 'Mo', pos: [-0.0000, 2.0808, -0.0000], label: 'Mo6' },
                { id: 7, element: 'O', pos: [0.0000, -0.0000, 0.0000], label: 'O7' },
                { id: 8, element: 'O', pos: [-0.0000, 1.9996, 1.9996], label: 'O8' },
                { id: 9, element: 'O', pos: [1.9996, 0.0000, 1.9996], label: 'O9' },
                { id: 10, element: 'O', pos: [0.0000, -1.9996, 1.9996], label: 'O10' },
                { id: 11, element: 'O', pos: [-1.9996, -0.0000, 1.9996], label: 'O11' },
                { id: 12, element: 'O', pos: [-1.9996, 0.0000, -1.9996], label: 'O12' },
                { id: 13, element: 'O', pos: [1.9996, -0.0000, -1.9996], label: 'O13' },
                { id: 14, element: 'O', pos: [-0.0000, 1.9996, -1.9996], label: 'O14' },
                { id: 15, element: 'O', pos: [-0.0000, -1.9996, -1.9996], label: 'O15' },
                { id: 16, element: 'O', pos: [1.9996, 1.9996, -0.0000], label: 'O16' },
                { id: 17, element: 'O', pos: [-1.9996, 1.9996, 0.0000], label: 'O17' },
                { id: 18, element: 'O', pos: [-1.9996, -1.9996, -0.0000], label: 'O18' },
                { id: 19, element: 'O', pos: [1.9996, -1.9996, 0.0000], label: 'O19' },
                { id: 20, element: 'O', pos: [-0.0000, 3.7729, 0.0000], label: 'O20' },
                { id: 21, element: 'O', pos: [3.7729, 0.0000, 0.0000], label: 'O21' },
                { id: 22, element: 'O', pos: [-3.7729, -0.0000, 0.0000], label: 'O22' },
                { id: 23, element: 'O', pos: [0.0000, -3.7729, 0.0000], label: 'O23' },
                { id: 24, element: 'O', pos: [-0.0000, -0.0000, 3.7729], label: 'O24' },
                { id: 25, element: 'O', pos: [-0.0000, 0.0000, -3.7729], label: 'O25' },
            ];

            const bonds = [
                [1, 7], [1, 11], [1, 12], [1, 17], [1, 18], [1, 22],
                [2, 7], [2, 12], [2, 13], [2, 14], [2, 15], [2, 25],
                [3, 7], [3, 8], [3, 9], [3, 10], [3, 11], [3, 24],
                [4, 7], [4, 9], [4, 13], [4, 16], [4, 19], [4, 21],
                [5, 7], [5, 10], [5, 15], [5, 18], [5, 19], [5, 23],
                [6, 7], [6, 8], [6, 14], [6, 16], [6, 17], [6, 20],
            ];

            const atomColors = {
                'Mo': 0x54C5C5,
                'O': 0xFF0D0D
            };

            const getRadius = (element) => {
                if (viewMode === 'space-fill') {
                    return element === 'Mo' ? 2.0 : 1.52;
                } else {
                    return element === 'Mo' ? 0.6 : 0.4;
                }
            };

            // Create atoms
            atoms.forEach((atom) => {
                const radius = getRadius(atom.element);
                const geometry = new THREE.SphereGeometry(radius, 32, 32);
                const material = new THREE.MeshPhongMaterial({
                    color: atomColors[atom.element],
                    shininess: 50
                });
                const sphere = new THREE.Mesh(geometry, material);
                sphere.position.set(atom.pos[0], atom.pos[1], atom.pos[2]);
                moleculeGroup.add(sphere);

                if (showLabels) {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = 256;
                    canvas.height = 128;
                    ctx.fillStyle = '#000000';
                    ctx.font = 'bold 72px Arial';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(atom.label, 128, 64);

                    const texture = new THREE.CanvasTexture(canvas);
                    const spriteMaterial = new THREE.SpriteMaterial({ map: texture });
                    const sprite = new THREE.Sprite(spriteMaterial);
                    sprite.scale.set(1.2, 0.6, 1);
                    sprite.position.set(atom.pos[0], atom.pos[1] + 0.8, atom.pos[2]);
                    moleculeGroup.add(sprite);
                }
            });

            // Create bonds
            if (viewMode === 'ball-stick') {
                bonds.forEach(([atomId1, atomId2]) => {
                    const atom1 = atoms.find(a => a.id === atomId1);
                    const atom2 = atoms.find(a => a.id === atomId2);
                    
                    if (!atom1 || !atom2) return;
                    
                    const start = new THREE.Vector3(atom1.pos[0], atom1.pos[1], atom1.pos[2]);
                    const end = new THREE.Vector3(atom2.pos[0], atom2.pos[1], atom2.pos[2]);
                    const direction = new THREE.Vector3().subVectors(end, start);
                    const length = direction.length();
                    
                    const geometry = new THREE.CylinderGeometry(0.1, 0.1, length, 8);
                    const material = new THREE.MeshPhongMaterial({ color: 0x888888 });
                    const cylinder = new THREE.Mesh(geometry, material);
                    
                    cylinder.position.copy(start).add(direction.multiplyScalar(0.5));
                    cylinder.lookAt(end);
                    cylinder.rotateX(Math.PI / 2);
                    
                    moleculeGroup.add(cylinder);
                });
            }
        }

        function setViewMode(mode) {
            viewMode = mode;
            buildMolecule();
            
            document.querySelectorAll('.controls button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        function toggleLabels() {
            showLabels = !showLabels;
            buildMolecule();
        }

        function onMouseDown(event) {
            isDragging = true;
            previousMouse = { x: event.clientX, y: event.clientY };
        }

        function onMouseMove(event) {
            if (!isDragging) return;
            
            const deltaX = event.clientX - previousMouse.x;
            const deltaY = event.clientY - previousMouse.y;
            
            moleculeGroup.rotation.y += deltaX * 0.01;
            moleculeGroup.rotation.x += deltaY * 0.01;
            
            previousMouse = { x: event.clientX, y: event.clientY };
        }

        function onMouseUp() {
            isDragging = false;
        }

        function onWindowResize() {
            const container = document.getElementById('canvas-container');
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }

        function animate() {
            requestAnimationFrame(animate);
            
            if (!isDragging) {
                moleculeGroup.rotation.y += 0.003;
            }
            
            renderer.render(scene, camera);
        }

        window.addEventListener('load', init);
    </script>
</body>
</html>